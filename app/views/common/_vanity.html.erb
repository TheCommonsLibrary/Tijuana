<% # lifted from Vanity gem %>
<% @vanity_experiments = Vanity.context.instance_eval{ @_vanity_experiments }%>
<% if @vanity_experiments.present? %>
  <%= javascript_tag do %>
    var httpRequest;
    var params = "v=<%= @vanity_experiments.map{|name, alternative| "#{name}=#{alternative.id}" }.join(',') %>&authenticity_token=<%= CGI.escape(form_authenticity_token) %>";
    if (window.XMLHttpRequest) { // Mozilla, Safari, ...
      httpRequest = new XMLHttpRequest();
    } else if (window.ActiveXObject) { // IE
      try { httpRequest = new ActiveXObject("Msxml2.XMLHTTP");  }
      catch (e) {  }
    }
    if (httpRequest) {
      httpRequest.open('POST', "<%= Vanity.playground.add_participant_path %>", true);
      httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      httpRequest.setRequestHeader("X-Requested-With", "XMLHttpRequest");
      httpRequest.send(params);
    }
  <% end %>
<% end %>

<% unless @vanity_experiments.nil? || @vanity_experiments.empty? %>
  <%= javascript_tag do %>
    <% ab_tests = @vanity_experiments.map { |n, a| "#{n}/#{a.value}" }.join(", ") %>
    ga('set', 'dimension6', '<%= escape_javascript ab_tests %>'); // AB Tests
  <% end %>
<% end %>
