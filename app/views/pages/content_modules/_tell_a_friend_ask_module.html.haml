- title ||= content_module.title
- content ||= content_module.content
- via_page_sequence = params[:via] && Page.find_by_id(params[:via]).try(:page_sequence)
- page_sequence = via_page_sequence || @page_sequence
- share_link ||= generate_short_link(page_sequence.pages.first, @token)
- tweet_text ||= page_sequence.tweet_text
- fb_title = via_page_sequence ? via_page_sequence.landing_page.name : open_graph_title
- fb_image = via_page_sequence ? via_page_sequence.facebook_image : open_graph_share_image_path
- fb_description = via_page_sequence ? via_page_sequence.html_meta_description : open_graph_description
- email_subject ||= page_sequence.email_subject
- email_body ||= page_sequence.email_body

.well
  %h2
    = title.upcase
  %p.caption
    =raw render_html(content)
  .addthis_toolbox{"addthis:url" => "#{share_link}", 'addthis:title' => fb_title, 'addthis:description' => fb_description, 'addthis:media' => fb_image}
    %a.ask-button.addthis_button_facebook
      %button.btn.btn-primary.btn-large.btn-social
        %span.icon
          %i.icon-facebook.icon-large
        %span.text
          Share
    %a.ask-button.addthis_button_twitter{"addthis:title" => tweet_text}
      %button.btn.btn-primary.btn-large.btn-social
        %span.icon
          %i.icon-twitter.icon-large
        %span.text
          Tweet
    %a.ask-button.addthis_button_email
      %button.btn.btn-primary.btn-large.btn-social
        %span.icon
          %i.icon-envelope-alt.icon-large
        %span.text
          Email
    %a.ask-button.addthis_button_google_plusone_share
      %button.btn.btn-primary.btn-large.btn-social
        %span.icon
          %i.icon-google-plus.icon-large
        %span.text
          Add

  %label
    Copy the link to IM, Skype or post it!
  %input.full{:cols => "1", :value => "#{share_link}"}
  .clearfix
  %hr
  .fb-like-above

- unless Rails.env == "test"
  :javascript
    $(function() {
      configureEmailShare("#{email_subject}", "#{raw escape_javascript(email_body)}");
    });
